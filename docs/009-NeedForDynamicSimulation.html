<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>The need for dynamic simulation ‚Äì Modelica &amp; FMI</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-7b1b06e26e1e2798ccde3208f86b5bbd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./002-Modelica101.html">Modelica</a></li><li class="breadcrumb-item"><a href="./009-NeedForDynamicSimulation.html">The need for dynamic simulation</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modelica &amp; FMI</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./001-Commitment.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A bit of context</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Modelica</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./002-Modelica101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modelica 101</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./003-FirstModel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Your first Modelica model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./004-FirstSimulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Your first Modelica simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./005-ModelRefactoring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Your first Modelica model refactoring</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./007-AcausalityEquation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acausality, the secret service of Modelica</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./008-AcausalityModels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">One model serves several purposes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./009-NeedForDynamicSimulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">The need for dynamic simulation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./010-WhatDynamicSimulationDoes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">What Dynamic Simulation Does?</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">FMI</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./006-SpreadingWithFMI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spreading the word with FMI</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-first-wrong-solution" id="toc-a-first-wrong-solution" class="nav-link active" data-scroll-target="#a-first-wrong-solution">A first (wrong) solution</a></li>
  <li><a href="#a-second-correct-solution" id="toc-a-second-correct-solution" class="nav-link" data-scroll-target="#a-second-correct-solution">A second (correct) solution</a>
  <ul class="collapse">
  <li><a href="#an-intuitive-next-step" id="toc-an-intuitive-next-step" class="nav-link" data-scroll-target="#an-intuitive-next-step">An intuitive next step</a></li>
  <li><a href="#a-small-amount-of-time-later" id="toc-a-small-amount-of-time-later" class="nav-link" data-scroll-target="#a-small-amount-of-time-later">A ‚Äúsmall amount of time‚Äù later</a></li>
  <li><a href="#until-the-last-drop" id="toc-until-the-last-drop" class="nav-link" data-scroll-target="#until-the-last-drop">Until the last drop</a></li>
  </ul></li>
  <li><a href="#what-about-different-dimensions-of-the-cone" id="toc-what-about-different-dimensions-of-the-cone" class="nav-link" data-scroll-target="#what-about-different-dimensions-of-the-cone">What about different dimensions of the cone</a></li>
  <li><a href="#the-end-for-today" id="toc-the-end-for-today" class="nav-link" data-scroll-target="#the-end-for-today">The END for today</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./002-Modelica101.html">Modelica</a></li><li class="breadcrumb-item"><a href="./009-NeedForDynamicSimulation.html">The need for dynamic simulation</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">The need for dynamic simulation</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/images/009/01_header.png" class="img-fluid figure-img"></p>
<figcaption>Which tanks empty first?</figcaption>
</figure>
</div>
<p><em>I hope you‚Äôve got your preferred drink in hand</em> ‚òïÔ∏èü´ñüíß</p>
<p>üì¨ üì∞ <strong>Saturday editions</strong> - for having more time to read during the weekend! Let‚Äôs experiment for a few weeks. Let me know if this is not a convenient day (‚ùì).</p>
<p>I guess you might have seen this image with the two tanks below. You might know the answer. Bear with me, I hope to bring a different twist to this problem.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/images/009/02_tankEmptying.jpeg" class="img-fluid figure-img"></p>
<figcaption>A problem to solve: which tank empties first?</figcaption>
</figure>
</div>
<p>LinkedIn has been on fire this week with this problem to solve. I am usually not putting too much attention on these, and this time is a bit different.</p>
<section id="a-first-wrong-solution" class="level2">
<h2 class="anchored" data-anchor-id="a-first-wrong-solution">A first (wrong) solution</h2>
<p>There were so many posts stating that both tanks would empty at the same time, because the height of both tanks is the same.</p>
<p>But first, not everyone knows hydraulics (or remember it) so let me explain quickly this statement: the pressure under water is due to the ‚Äúcolumn of water‚Äù (basically the height of water) above the point at which you want to know the pressure. So if you swim above water, you just get the atmospheric pressure and, as soon as you dive, you start getting more pressure induced by the water above you. The deeper you dive, the more pressure applies on your body.</p>
<p>So, the (wrong) argumentation goes:</p>
<ol type="1">
<li>the same height of the tank, the same pressure at the bottom!</li>
<li>And the same pressure at the bottom, the same amount of water flows through the valve.</li>
<li>So they empty in the same amount of time? üßê</li>
</ol>
<p>Well, no. The first two points are correct, and the conclusion in 3. is wrong.</p>
<p>Why?</p>
<p>Because this only considers the initial conditions of the problem. What about the dynamics of the system?</p>
</section>
<section id="a-second-correct-solution" class="level2">
<h2 class="anchored" data-anchor-id="a-second-correct-solution">A second (correct) solution</h2>
<p><em>Note: this entire article uses volume flow rate and not mass flow rate. These are in this case equivalent because the temperature is considered constant and the pressure at the ports is the same. It is just more intuitive to discuss volumes and volume flow rate than masses of fluid and mass flow rates.</em></p>
<section id="an-intuitive-next-step" class="level3">
<h3 class="anchored" data-anchor-id="an-intuitive-next-step">An intuitive next step</h3>
<p>So 1. and 2. above are correct. After a short amount of time, the same amount of flow would have gone through both valves, right? Let‚Äôs remind ourselves that the flow is actually here a volume flow rate <code>V_flow</code>, and is expressed in unit <code>[m^3/s]</code>. And when we consider a volume flow rate over time <code>[s]</code>, this means that we are looking at the volume of water <code>[m^3]</code> that left the tank.</p>
<pre><code>V_flow * Œît = V
# which is consistent with the unit check
# [m^3/s] * [s] = [m^3]</code></pre>
<p>Ok, so <mark>the same volume of water exits both tanks in the first short amount of time</mark>. So the same volume remains on both tanks. Now you see me coming:</p>
<ul>
<li>the same volume remains on both tanks,</li>
<li>the two tanks have different shapes,</li>
<li>In Tank X (with smaller base and larger top), the remaining volume of fluid will lead to a higher remaining column of fluid than in Tank Y. And this is because the larger top will mean less change of height is needed for covering a given volume.</li>
<li>And so after the first ‚Äúsmall amount of time‚Äù, the height in both tanks will differ.</li>
<li>And if the heights differ, so do the pressures at the bottom.</li>
<li>And if the pressures at the bottom of the tanks differ, so do the flow through the valves.</li>
<li>And thus already on the next ‚Äúsmall amount of time‚Äù, the volume in both tanks will differ.</li>
</ul>
<p>Oh, so after two ‚Äúsmall amounts of time‚Äù later, we already see a difference in behavior. And if one applies the logic of the <a href="#a-first-wrong-solution">‚Äúfirst (wrong) solution‚Äù</a> at this point, then one would already have a different answer. So the real solution will appear once we continue with ‚Äúsmall amount of time‚Äù later until we empty the tanks!</p>
</section>
<section id="a-small-amount-of-time-later" class="level3">
<h3 class="anchored" data-anchor-id="a-small-amount-of-time-later">A ‚Äúsmall amount of time‚Äù later</h3>
<p>Intuitively, we discussed that: 1. At a point in time, the behavior of a system can be studied. 2. A small amount of time later, we can assess a new ‚Äúpoint in time‚Äù. 3. and we loop over 1. and 2. over and over again.</p>
<p>Well that, Ladies and Gentlemen, is exactly what <strong><em>dynamic simulation</em></strong> does! üòâ Let‚Äôs make the analogy clearer:</p>
<ol type="1">
<li>We can decompose a bit 1. by highlighting that a subset of the variables of our system can define fully the <code>state</code> of our system - these are the <code>state variables</code> (called often <code>states</code>) -, and the other variables can be computed from the <code>states</code>.</li>
<li>The simulation <code>solver</code> does compute the <code>states</code> after a small <code>time step</code> - which is the ‚Äúsmall amount of time‚Äù later.</li>
<li>and when we simulate, we define a <code>final time</code> of simulation or conditions to stop the simulation.</li>
</ol>
<p>So we can model and simulate this problem!</p>
</section>
<section id="until-the-last-drop" class="level3">
<h3 class="anchored" data-anchor-id="until-the-last-drop">Until the last drop</h3>
<p>Obviously, it is not enough to just trust this intuitive reasoning and one could easily wonder whether there is a later point where ‚Äúthings go south‚Äù. <em>Spoiler: the trend continues because the shapes - volume versus height - are linearly evolving. Said differently, the pressure will be higher for a larger fraction of the volume.</em> So let‚Äôs simulate this problem until the last drop is out of one tank!</p>
<p>First, we need the right components:</p>
<ul>
<li>a <code>Reservoir</code> that is parametrized based on the truncated conical shape,</li>
<li>an <code>Orifice</code> which models the faucet, and</li>
<li>the <code>Environment</code> which basically is the constant atmospheric pressure and can receive as much flow as needed.</li>
</ul>
<p>The reservoir is obviously the most specific to this problem. Let‚Äôs look at the main equations and jump into the simulation part:</p>
<pre><code>1. port.p = p_atm + p_hyd;
2. p_hyd = rho*g_n*h "Pressure head";
3. der(V) = port.V_flow;
4. V = pi * h / 3 * (R_base^2 + R_base * R_surface + R_surface^2);
5. R_surface = R_base + k_geom * h;
6. k_geom = (R_top - R_base)/H_tank ;</code></pre>
<p>Not to fill too much the equation block, I pull the explanation of each line out of the block:</p>
<ol type="1">
<li>The port being at the bottom its pressure is the sum of the air and fluid pressure.</li>
<li>Head induced pressure, i.e.&nbsp;induced by the mass of the fluid above the port.</li>
<li>The reduction of volume is the flow that leaves the tank.</li>
<li>The volume of the truncated conical shape is based on the height (in R_surface), and base and top radii.</li>
<li>The radius at the surface of water is function of the height, and the shape.</li>
<li>The shape of the cone can be modeled by one base radius and the slope in change of radii.</li>
</ol>
<p>So what is important to see here is that the physics modeled takes into account the head as a function of the height of fluid, which itself is function of the volume of fluid remaining and the shape of the tank.</p>
<p>Let‚Äôs simulate this! We build two configurations as per the image.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/images/009/03_tankModel.jpeg" class="img-fluid figure-img"></p>
<figcaption>The Modelica model of the two tanks emptying</figcaption>
</figure>
</div>
<p>Ok, the icons are ugly‚Ä¶ but that‚Äôs not the point! I have other priorities in life üòÖ As you see, the dimension of <code>tankX</code> are set to the flipped dimensions of <code>tankY</code>.</p>
<p>So now we can look at the behavior and the answer you want to see is ‚Äúwhich one empties first?‚Äù, let‚Äôs plot the level of fluid against time:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/images/009/04_tanksEmptying.png" class="img-fluid figure-img"></p>
<figcaption>Looking at the fluid levels: tankX empties before tankY!</figcaption>
</figure>
</div>
<p>This is exactly what we expected: <code>tankX</code> level stays higher longer than <code>tankY</code> and therefore has more head over time (head is linear with height remember), so empties faster overall.</p>
<p>But why is it counter intuitive when seeing this curve? Well, it seems that <code>tankY</code> was ahead of <code>tankX</code> but that was only an illusion! We are looking at the height, and instead we can look at the remaining volume of fluid. Let‚Äôs change perspective:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/images/009/05_tanksEmptyingVolumes.png" class="img-fluid figure-img"></p>
<figcaption>Looking at the remaining fluid volumes - it becomes clearer!</figcaption>
</figure>
</div>
<p>It is clear that, from just after the start, the remaining volume of water in <code>tankX</code> is lower than <code>tankY</code>. So <code>tankX</code> was ahead all the time!</p>
<p><em>A good analogy just came to mind: you know how when you look at an athletic runner race on a track üèÉ‚Äç‚ôÄÔ∏èüèÉüèÉ‚Äç‚ôÇÔ∏è, it always seems that the one more inside the track is behind - they start behind actually - but catch up during the curve because their remaining path along the curvature is shorter. Same thing here: there is less volume to outflow for a given height of <code>tankX</code>.</em></p>
<p>Finally, a nice summary plot is to look at the head pressure at the bottom of each tank as a function of the remaining volume of fluid.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/images/009/06_tanksHeadVolume.png" class="img-fluid figure-img"></p>
<figcaption>TankX has, for a given volume, always more head than TankY</figcaption>
</figure>
</div>
</section>
</section>
<section id="what-about-different-dimensions-of-the-cone" class="level2">
<h2 class="anchored" data-anchor-id="what-about-different-dimensions-of-the-cone">What about different dimensions of the cone</h2>
<p>The reflection in all the above was done without dimensions so the reasoning stands. Nevertheless, all the simulations were done for one set of conditions: a volume of 1000L, a height of 1m and the base diameter of <code>tankY</code> being 1.5m (respectively the top diameter of <code>tankX</code>).</p>
<p>Because it is easy to simulate, we can close this article by playing around with the based diameter of <code>tankY</code>. A quick solving shows that if the diameter <code>D_base</code> is around ~1.15m then we have a cylinder and not a cone. And if we have a <code>D_base</code> above ~1.95m then even a <code>D_top</code> of 0 would lead to more than 1000L of water. Hence, we can explore a design of <code>D_base</code> between 1.2 and 1.9m.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./assets/images/009/07_DOE.png" class="img-fluid figure-img"></p>
<figcaption>Varying the base diameter from 1.2 to 1.9m with 0.1m increments</figcaption>
</figure>
</div>
<p>We see clearly that, from two nearly cylindrical cones (hence nearly identical responses), to the more complete cone (when <code>D_base</code> gets larger, <code>D_top</code> reduces to host the same volume of 1000L), then the trend is unchanged: <code>tankX</code> always empties faster - for the same reason as explained above.</p>
</section>
<section id="the-end-for-today" class="level2">
<h2 class="anchored" data-anchor-id="the-end-for-today">The END for today</h2>
<p>Enough for today.</p>
<p>I hope you enjoyed digging into this puzzle and seeing that the reasoning steps where basically our brains doing dynamic simulation üòâ!</p>
<p><em>Break is over, go back to what you were doing.</em></p>
<p>Cl√©ment</p>
<p><a href="./010-WhatDynamicSimulationDoes.html">Next</a> -&gt;</p>


</section>

<p>¬© 2025 Cl√©ment Co√Øc ‚Äî Licensed under <a href="https://creativecommons.org/licenses/by-nc/4.0/">creative commons 4.0</a>. Non-commercial use only.</p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>